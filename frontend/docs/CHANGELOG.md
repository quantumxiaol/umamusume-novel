# 前端更新日志

## 2025-11-04 - 流式响应增强

### 新增功能

#### 1. RAG 和 Web 搜索结果展示
- ✨ 新增 RAG 搜索结果的实时显示
- ✨ 新增 Web 搜索结果的实时显示
- 📦 使用可折叠组件展示，避免页面过长
- 📊 显示结果字符数统计

#### 2. 用户体验优化
- 🎨 可折叠/展开的结果展示区域
- 🎯 点击标题即可展开/折叠
- 💫 平滑的展开/折叠动画效果
- 📜 结果区域支持滚动查看（最大高度 400px）
- 🎨 美化的滚动条样式

#### 3. 界面改进
- 🔍 清晰的视觉层次结构
- ▶️ 三角形指示器显示折叠状态
- 📝 字符数统计显示在标题右侧
- 🎨 悬停效果增强交互体验

### 技术细节

#### 修改的文件

1. **`src/stores/novelStore.js`**
   - 新增 `ragResult` 和 `webResult` 状态
   - 更新流式生成逻辑以接收和存储 RAG/Web 结果
   - 更新清除逻辑以重置新状态

2. **`src/App.vue`**
   - 新增折叠状态管理 (`showRagResult`, `showWebResult`)
   - 新增可折叠组件模板
   - 新增样式：
     - `.collapsible-section` - 折叠区域容器
     - `.collapsible-header` - 可点击的标题栏
     - `.collapsible-content` - 内容区域
     - `.result-text` - 结果文本样式
     - 自定义滚动条样式

### 后端集成

后端流式响应已支持以下事件：
- `status` - 状态更新
- `rag_result` - RAG 搜索结果
- `web_result` - Web 搜索结果
- `token` - 流式小说内容
- `done` - 生成完成
- `error` - 错误信息

### 使用方法

1. 启动后端服务
2. 启动前端服务：`pnpm dev`
3. 在浏览器中打开前端页面
4. 勾选"流式模式"
5. 输入创作指令并点击"生成小说"
6. 等待生成过程：
   - RAG 搜索结果会首先显示（可折叠）
   - Web 搜索结果随后显示（可折叠）
   - 小说内容实时流式显示
7. 点击 RAG/Web 结果标题可展开查看详细内容

### 视觉效果

```
┌─────────────────────────────────────────┐
│ ▶ RAG 搜索结果        (1234 字符)      │  ← 点击展开
├─────────────────────────────────────────┤
│ ▼ Web 搜索结果        (5678 字符)      │  ← 已展开
│ ┌─────────────────────────────────────┐ │
│ │ 详细的搜索结果内容...                │ │
│ │ 可滚动查看                           │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 生成的小说:                             │
│ ┌─────────────────────────────────────┐ │
│ │ 小说内容实时显示...                  │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 下一步计划

- [ ] 添加导出功能（导出 RAG/Web 结果和小说）
- [ ] 添加历史记录功能
- [ ] 支持结果的复制和下载
- [ ] 添加搜索结果的关键词高亮

